// Hem mod√ºler hem global API kullanƒ±mƒ± √∂rneƒüi
console.log("üîÑ Starting Mixed Usage Demo (Modular + Global)...");

// Global API'leri kullan (backward compatibility)
console.log("üåê Using global APIs:");
console.log("  - process.env.USER:", process.env.USER || "unknown");
console.log("  - process.cwd():", process.cwd());

// Global fetch kullan
console.log("üåç Testing global fetch API...");
fetch("https://api.github.com/users/github")
  .then(response => {
    console.log("‚úÖ Global fetch working - Status:", response.status);
  })
  .catch(error => {
    console.log("‚ö†Ô∏è  Global fetch failed:", error.message);
  });

// Global timer kullan
setTimeout(() => {
  console.log("‚è∞ Global setTimeout working!");
}, 1000);

// ES Modules ile HTTP ve FS import et
Promise.all([
  import("kiren/http"),
  import("kiren/fs")
]).then(([http, fs]) => {
  console.log("üéØ Modular imports loaded successfully!");
  
  // Mod√ºler FS ile dosya olu≈ütur
  const configFile = "mixed-config.json";
  const config = {
    serverPort: 3002,
    environment: "development",
    features: {
      globalAPIs: true,
      modularImports: true,
      mixedUsage: true
    },
    createdAt: new Date().toISOString()
  };
  
  console.log("üíæ Creating config file with modular FS...");
  fs.writeFile(configFile, JSON.stringify(config, null, 2));
  
  // Mod√ºler HTTP ile server olu≈ütur
  console.log("üöÄ Creating HTTP server with modular import...");
  const server = http.createServer();
  
  // Routes
  server.get("/", () => {
    return "Mixed Usage Demo - Global + Modular APIs working together! ü§ù";
  });
  
  server.get("/config", () => {
    // Mod√ºler FS ile config dosyasƒ±nƒ± oku
    const configContent = fs.readFile(configFile);
    return JSON.parse(configContent);
  });
  
  server.get("/system", () => {
    // Global process API kullan
    return {
      runtime: "kiren",
      usage: "mixed (global + modular)",
      environment: process.env.NODE_ENV || "development",
      cwd: process.cwd(),
      args: process.argv
    };
  });
  
  // Server'ƒ± ba≈ülat
  server.listen(config.serverPort);
  
  console.log("üéâ Mixed usage demo ready!");
  console.log(`üìã Server running on port ${config.serverPort}`);
  console.log("üîó Available endpoints:");
  console.log(`  - GET  http://localhost:${config.serverPort}/`);
  console.log(`  - GET  http://localhost:${config.serverPort}/config`);
  console.log(`  - GET  http://localhost:${config.serverPort}/system`);
  console.log(`  - GET  http://localhost:${config.serverPort}/health`);
  
}).catch(error => {
  console.error("‚ùå Failed to load modular APIs:", error);
});

console.log("‚ú® Mixed usage demo initialized - combining the best of both worlds!");